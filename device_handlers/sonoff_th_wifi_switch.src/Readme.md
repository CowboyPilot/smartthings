Code extracted from https://github.com/erocm123/SmartThingsPublic
